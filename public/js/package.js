!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}({0:function(t,e,n){n("y+n2"),t.exports=n("fi46")},fi46:function(t,e){},"y+n2":function(t,e,n){"use strict";n.r(e);function i(t,e,n,i,a,o,s,r){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),s?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=l):a&&(l=r?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,l):[l]}return{exports:t,options:c}}var a=i({props:{endpointId:{type:Number,required:!1,default:void 0}},data:function(){return{httpMethods:["GET","POST","PUT","DELETE"],endpoint:{name:null,type:null,api:null,description:null},params:[],addParams:!1,viewFlag:!0,submitted:!1,error:null}},computed:{endpointNameState:function(){return(null!==this.endpoint.name&&""!==this.endpoint.name||!1===this.submitted)&&null},endpointTypeState:function(){return(null!==this.endpoint.type&&""!==this.endpoint.type||!1===this.submitted)&&null},endpointApiState:function(){return(null!==this.endpoint.api&&""!==this.endpoint.api||!1===this.submitted)&&null},endpointDescriptionState:function(){return(null!==this.endpoint.description&&""!==this.endpoint.description||!1===this.submitted)&&null}},watch:{endpointId:function(t){void 0!==t&&(null!==t?this.updateEndpoint(t):this.createEndpoint())}},methods:{clearEndpoint:function(){this.endpoint={name:null,type:null,api:null,description:null},this.params=[{key:"",value:"",jsonFormat:!1}],this.addParams=!1,this.submitted=!1,this.$emit("clear-selection")},closeModal:function(){this.clearEndpoint(),this.$bvModal.hide("endpoint-data")},addParam:function(){this.params.push({id:(Math.random()+1).toString(36).substring(7),key:"",value:"",jsonFormat:!1})},removeParam:function(t){this.params.splice(t,1)},formatJson:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.viewFlag=!1;var n=this.params[t].value;if(this.IsValidJSONString(n)){var i=JSON.parse(n);void 0!==e&&(this.params[t].jsonFormat=e),this.params[t].jsonFormat?this.params[t].value=JSON.stringify(i,void 0,2):this.params[t].value=JSON.stringify(i)}this.viewFlag=!0},IsValidJSONString:function(t){try{JSON.parse(t)}catch(t){return!1}return!0},createEndpoint:function(){this.clearEndpoint(),this.$bvModal.show("endpoint-data")},updateEndpoint:function(t){var e=this;ProcessMaker.apiClient.get("ps_ethos/ps_ethos_connector/".concat(t),{}).then((function(t){var n=t.data.api.split("?"),i=[];if(n.length>1){for(var a=n[1].split("&"),o=0;o<a.length;o+=1)i=a[o].split("="),e.params[o]={id:(Math.random()+1).toString(36).substring(7),key:i[0],value:i[1],jsonFormat:!1};e.addParams=!0}e.endpoint={name:t.data.name,type:t.data.type,api:n[0],description:t.data.description}})).catch((function(t){422===t.response.status&&(e.error=t.response.data.errors)})),this.$bvModal.show("endpoint-data")},saveEndpoint:function(){var t=this;if(this.submitted=!0,this.validateForm()){var e={id:this.endpointId,name:this.endpoint.name,type:this.endpoint.type,api:this.buildUrl(),description:this.endpoint.description};null===this.endpointId||void 0===this.endpointId?ProcessMaker.apiClient.post("ps_ethos/ps_ethos_connector",e).then((function(){ProcessMaker.alert("Endpoint successfully saved. ","success")})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)})).finally((function(){t.$emit("refresh-data"),t.closeModal()})):ProcessMaker.apiClient.put("ps_ethos/ps_ethos_connector",e).then((function(){ProcessMaker.alert("Endpoint successfully saved. ","success")})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)})).finally((function(){t.$emit("refresh-data"),t.closeModal()}))}},buildUrl:function(){var t,e=this.endpoint.api,n=this.params;if(this.addParams){if(n.length>0){for(var i="",a=!1,o=0;o<n.length;o+=1)""!==n[o].key&&""!==n[o].value&&(t=n[o].value,this.IsValidJSONString(t)&&(t=JSON.stringify(JSON.parse(t))),a?i+="&".concat(n[o].key,"=").concat(t):(i+="?".concat(n[o].key,"=").concat(t),a=!0));return e+i}return e}return e},validateForm:function(){var t=!0,e=this.endpoint;return null!==e.name&&0!==e.name.length||(t=!1),null===e.type&&(t=!1),null!==e.api&&0!==e.api.length||(t=!1),null!==e.description&&0!==e.description.length||(t=!1),t}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-modal",{attrs:{id:"endpoint-data","no-close-on-esc":""},scopedSlots:t._u([{key:"modal-header-close",fn:function(){return[n("p",{on:{click:function(e){return t.closeModal()}}},[t._v("x")])]},proxy:!0},{key:"modal-title",fn:function(){return[t._v("Endpoint")]},proxy:!0},{key:"modal-footer",fn:function(){return[n("div",{staticClass:"float-left"},[n("button",{staticClass:"btn btn-sm btn-secondary",on:{click:function(e){return t.closeModal()}}},[t._v("Cancel")]),t._v(" "),n("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(e){return t.saveEndpoint()}}},[t._v("Save")])])]},proxy:!0}])},[t._v(" "),t._v(" "),n("b-form-group",{attrs:{id:"label-endpoint-name",label:"Name","label-for":"input-endpoint-name"}},[n("b-form-input",{attrs:{id:"input-endpoint-name",type:"text",placeholder:"Enter endpoint name",required:"",state:t.endpointNameState},model:{value:t.endpoint.name,callback:function(e){t.$set(t.endpoint,"name",e)},expression:"endpoint.name"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-endpoint-name-feedback"}},[t._v("This field is required")])],1),t._v(" "),n("b-form-group",{attrs:{id:"label-endpoint-type",label:"Method","label-for":"input-endpoint-type"}},[n("b-form-select",{attrs:{id:"input-endpoint-type",options:t.httpMethods,state:t.endpointTypeState,required:""},scopedSlots:t._u([{key:"first",fn:function(){return[n("b-form-select-option",{attrs:{value:null,disabled:""}},[t._v("Please select a method")])]},proxy:!0}]),model:{value:t.endpoint.type,callback:function(e){t.$set(t.endpoint,"type",e)},expression:"endpoint.type"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-endpoint-type-feedback"}},[t._v("This field is required")])],1),t._v(" "),n("b-form-group",{attrs:{id:"label-endpoint-api",label:"API Url","label-for":"input-endpoint-api"}},[n("b-form-input",{attrs:{id:"input-endpoint-api",type:"text",placeholder:"Enter endpoint api",required:"",state:t.endpointApiState},model:{value:t.endpoint.api,callback:function(e){t.$set(t.endpoint,"api",e)},expression:"endpoint.api"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-endpoint-api-feedback"}},[t._v("This field is required")])],1),t._v(" "),n("b-form-group",{attrs:{id:"label-endpoint-add-params",label:"Options","label-for":"input-endpoint-add-params"}},[n("b-form-checkbox",{attrs:{id:"input-endpoint-add-params",switch:""},model:{value:t.addParams,callback:function(e){t.addParams=e},expression:"addParams"}},[t._v("Add more params?")])],1),t._v(" "),n("b-form-group",{directives:[{name:"show",rawName:"v-show",value:t.addParams,expression:"addParams"}],attrs:{id:"label-endpoint-api",label:"API Parameters","label-for":"input-endpoint-params"}},[n("div",{staticClass:"row mb-3"},[n("div",{staticClass:"col-5"},[t._v("Param")]),t._v(" "),n("div",{staticClass:"col-5"},[t._v("Value")]),t._v(" "),n("div",{staticClass:"col-2"},[n("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(e){return t.addParam()}}},[n("i",{staticClass:"fa fa-plus"})])],1)]),t._v(" "),t._l(t.params,(function(e,i){return n("div",{key:e.id,staticClass:"row"},[n("div",{staticClass:"col-5"},[n("b-form-input",{attrs:{size:"sm",placeholder:"Param"},model:{value:e.key,callback:function(n){t.$set(e,"key",n)},expression:"item.key"}})],1),t._v(" "),n("div",{staticClass:"col-5"},[n("b-form-textarea",{staticStyle:{"font-size":"11px"},attrs:{placeholder:"value...",rows:"3"},on:{change:function(e){return t.formatJson(i)}},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}}),t._v(" "),t.viewFlag?n("b-form-checkbox",{staticClass:"text-right",attrs:{switch:"",size:"sm"},on:{change:function(e){return t.formatJson(i,e)}},model:{value:e.jsonFormat,callback:function(n){t.$set(e,"jsonFormat",n)},expression:"item.jsonFormat"}},[t._v("JSON")]):t._e()],1),t._v(" "),n("div",{staticClass:"col-2"},[n("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){return t.removeParam(i)}}},[n("i",{staticClass:"fa fa-trash"})])],1)])}))],2),t._v(" "),n("b-form-group",{attrs:{id:"label-endpoint-description",label:"Description","label-for":"input-endpoint-description"}},[n("b-form-textarea",{attrs:{id:"input-endpoint-description",type:"text",rows:"2",placeholder:"Enter endpoint description",required:"",state:t.endpointDescriptionState},model:{value:t.endpoint.description,callback:function(e){t.$set(t.endpoint,"description",e)},expression:"endpoint.description"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-endpoint-api-feedback"}},[t._v("This field is required")])],1)],1)}),[],!1,null,null,null),o=i({components:{EndpointModal:a.exports},data:function(){return{fields:[{key:"name",label:"Name"},{key:"type",label:"Type"},{key:"api",label:"Api"},{key:"description",label:"Description"},{key:"actions",label:"Actions"}],endpoints:[],selectedEndpoint:void 0,filter:"",loading:!1,currentPage:1,perPage:10,lastPage:null,totalRows:0,error:null}},computed:{captionTableToggle:function(){return 0!==this.totalRows}},methods:{clearSelection:function(){this.selectedEndpoint=void 0},refreshData:function(){this.clearSelection(),this.$refs.endpointsTable.refresh()},getData:function(){var t=this;return ProcessMaker.apiClient.get("ps_ethos/ps_ethos_connector?page=".concat(this.currentPage,"&filter=").concat(this.filter,"&per_page=").concat(this.perPage)).then((function(e){return t.totalRows=e.data.meta.total,e.data.data||[]})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)})).finally((function(){t.loading=!1}))},regenerateConnectors:function(){var t=this;ProcessMaker.apiClient.get("ps_ethos/auth",{}).then((function(t){t.data.split(" ").includes("ERROR:")?ProcessMaker.alert(t.data,"warning"):ProcessMaker.alert(t.data,"success")})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)})).finally((function(){t.refreshData()}))},addEndpoint:function(){this.selectedEndpoint=null},editEndpoint:function(t){this.selectedEndpoint=t},deleteEndpoint:function(t){var e=this;ProcessMaker.confirmModal("Caution!","Are you sure to delete this endpoint","",(function(){ProcessMaker.apiClient.post("ps_ethos/ps_ethos_connector/".concat(t),{}).then((function(){ProcessMaker.alert("Endpoint successfully deleted ","success")})).catch((function(t){422===t.response.status&&(e.error=t.response.data.errors)})).finally((function(){e.refreshData()}))}))}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-card",{attrs:{"header-text-variant":"white","footer-tag":"footer"}},[n("b-card-text",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 col-md-4"},[n("div",{staticClass:"input-group"},[n("div",{staticClass:"input-group-prepend"},[n("span",{staticClass:"input-group-text",attrs:{id:"basic-addon1"}},[n("i",{staticClass:"fas fa-search"})])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.filter,expression:"filter"}],staticClass:"form-control",attrs:{placeholder:"Find Endpoint..."},domProps:{value:t.filter},on:{input:function(e){e.target.composing||(t.filter=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"col-6 offset-md-4 col-md-2"},[n("button",{staticClass:"btn btn-success btn-sm btn-block",on:{click:function(e){return t.addEndpoint()}}},[n("i",{staticClass:"fas fa-plus"}),t._v(" Endpoint\n          ")])]),t._v(" "),n("div",{staticClass:"col-6 col-md-2"},[n("button",{staticClass:"btn btn-info btn-sm btn-block",on:{click:function(e){return t.regenerateConnectors()}}},[n("i",{staticClass:"fas fa-sync-alt"}),t._v(" Regenerate\n          ")])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("b-table",{ref:"endpointsTable",staticClass:"mt-3",attrs:{responsive:"",striped:"",hover:"",bordered:"",fields:t.fields,items:t.getData,busy:t.loading,"per-page":t.perPage,"current-page":t.currentPage,filter:t.filter,"show-empty":""},scopedSlots:t._u([{key:"empty",fn:function(e){return[n("h4",{staticClass:"text-center",staticStyle:{padding:"50px 0px"}},[n("i",{staticClass:"fas fa-times-circle"}),t._v("\n                "+t._s(e.emptyText)+"\n              ")])]}},{key:"emptyfiltered",fn:function(e){return[n("h4",{staticClass:"text-center",staticStyle:{padding:"50px 0px"}},[n("i",{staticClass:"fas fa-times-circle"}),t._v("\n                "+t._s(e.emptyFilteredText)+"\n              ")])]}},{key:"table-busy",fn:function(){return[n("div",{staticClass:"text-center mt-5 my-2"},[n("b-spinner",{staticClass:"align-middle"}),t._v(" "),n("strong",[t._v("Loading...")])],1)]},proxy:!0},{key:"cell(actions)",fn:function(e){return[n("b-button-group",{attrs:{size:"sm"}},[n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"Edit",variant:"info"},on:{click:function(n){return t.editEndpoint(e.item.id)}}},[n("i",{staticClass:"fas fa-edit"})]),t._v(" "),n("b-button",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:"Delete",variant:"danger"},on:{click:function(n){return t.deleteEndpoint(e.item.id)}}},[n("i",{staticClass:"fas fa-trash"})])],1)]}}])})],1)]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4 text-align-left"},[n("p",{directives:[{name:"show",rawName:"v-show",value:t.captionTableToggle,expression:"captionTableToggle"}]},[t._v("\n            "+t._s(1+10*(t.currentPage-1))+" -\n            "+t._s(t.totalRows>10*t.currentPage?10*t.currentPage:t.totalRows)+"\n            of "+t._s(t.totalRows)+" Endpoints\n          ")])]),t._v(" "),n("div",{staticClass:"col-8 offset-md-4 col-md-4"},[n("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage,align:"fill",size:"sm"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)])])],1),t._v(" "),n("endpoint-modal",{attrs:{"endpoint-id":t.selectedEndpoint},on:{"refresh-data":t.refreshData,"clear-selection":t.clearSelection}})],1)}),[],!1,null,null,null).exports,s=i({data:function(){return{config:{uri:null,ethosToken:null},error:null,submitted:!1}},computed:{configUriState:function(){return(null!==this.config.uri&&""!==this.config.uri||!1===this.submitted)&&null},configEthosKeyState:function(){return(null!==this.config.ethosToken&&""!==this.config.ethosToken||!1===this.submitted)&&null}},mounted:function(){this.getConfig()},methods:{getConfig:function(){var t=this;ProcessMaker.apiClient.get("ps_ethos/get-config",{}).then((function(e){t.config.uri=e.data.uri,t.config.ethosToken=e.data.ethosKey})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)}))},saveConfig:function(){var t=this;this.submitted=!0,this.validateForm()&&ProcessMaker.apiClient.put("ps_ethos/config-update",{base_uri:this.config.uri,ethos_token:this.config.ethosToken}).then((function(){ProcessMaker.alert("The configuration has been updated","success"),t.submitted=!1})).catch((function(e){422===e.response.status&&(t.error=e.response.data.errors)}))},validateForm:function(){var t=!0,e=this.config;return null!==e.uri&&0!==e.uri.length||(t=!1),null!==e.ethosToken&&0!==e.ethosToken.length||(t=!1),t}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-card",{attrs:{"header-text-variant":"white","footer-tag":"footer"}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-6 col-sm-12"},[n("b-form-group",{attrs:{id:"label-config-uri",label:"Base URI:","label-for":"input-config-uri"}},[n("b-form-input",{attrs:{id:"input-config-uri",type:"text",placeholder:"Enter Base URI",required:"",state:t.configUriState},model:{value:t.config.uri,callback:function(e){t.$set(t.config,"uri",e)},expression:"config.uri"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-config-uri-feedback"}},[t._v("This field is required")])],1)],1),t._v(" "),n("div",{staticClass:"col-md-6 col-sm-12"},[n("b-form-group",{attrs:{id:"label-config-ethos-key",label:"Ethos Key:","label-for":"input-config-ethos-key"}},[n("b-form-input",{attrs:{id:"input-config-ethos-key",type:"password",placeholder:"Enter Ethos Key",required:"",state:t.configEthosKeyState},model:{value:t.config.ethosToken,callback:function(e){t.$set(t.config,"ethosToken",e)},expression:"config.ethosToken"}}),t._v(" "),n("b-form-invalid-feedback",{attrs:{id:"input-config-ethos-key-feedback"}},[t._v("This field is required")])],1)],1)]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-sm-12",attrs:{align:"right"}},[n("b-button",{attrs:{variant:"info"},on:{click:function(e){return t.saveConfig()}}},[n("i",{staticClass:"fa fa-save"}),t._v(" Save\n      ")])],1)])])}),[],!1,null,null,null).exports;new Vue({el:"#app-ps_ethos",data:{},components:{BannerEthosTab:o,CredentialsTab:s}})}});